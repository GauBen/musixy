!function(){function t(t){return t&&t.__esModule?t.default:t}class i{constructor(t,e){if(t instanceof i||t instanceof Object&&"x"in t&&"y"in t)return this.x=t.x,void(this.y=t.y);this.x=t,this.y=e}add(t){return new i(this.x+t.x,this.y+t.y)}sub(t){return new i(this.x-t.x,this.y-t.y)}scale(t){return new i(this.x*t,this.y*t)}rotate(t){return new i(this.x*Math.cos(t)-this.y*Math.sin(t),this.x*Math.sin(t)+this.y*Math.cos(t))}len2(){return this.x*this.x+this.y*this.y}len(){return Math.sqrt(this.len2())}normalize(){return new i(this.x/this.len(),this.y/this.len())}}class e{constructor(t,{x:[i,e],y:[s,r],width:a,height:n,pixelRatio:o}){this.canvas=t,this.context=t.getContext("2d"),this.fromX=i,this.fromY=s,this.toX=e,this.toY=r,this.resize(a,n,o),this.clear()}resize(t,i,e){this.width=t,this.height=i,this.pixelRatio=e,this.canvas.width=t*e,this.canvas.height=i*e,this.canvas.style.width=`${t}px`,this.canvas.style.height=`${i}px`,this.context.lineWidth=3*e}clear(){this.context.clearRect(0,0,this.width*this.pixelRatio,this.height*this.pixelRatio),this.context.lineJoin="round",this.context.lineCap="round",this.context.lineWidth=2*this.pixelRatio,this.context.fillStyle="#000",this.context.strokeStyle="#000"}drawArrow(t,i){const e=this.toCanvasVector(t),s=this.toCanvasVector(i),r=this.context,a=s.sub(e).normalize();r.beginPath(),r.moveTo(e.x,e.y),r.lineTo(s.x-10*a.x,s.y-10*a.y),r.stroke(),r.beginPath(),r.moveTo(s.x,s.y);const n=s.add(a.scale(20*this.pixelRatio).rotate(3*Math.PI/4)),o=s.add(a.scale(20*this.pixelRatio).rotate(5*Math.PI/4));r.lineTo(n.x,n.y),r.lineTo(o.x,o.y),r.closePath(),r.fillStyle="#000",r.fill()}drawPolyLine(t,i=null){const e=this.context;let s=this.toCanvasVector(t[0]);e.beginPath(),e.moveTo(s.x,s.y);for(const i of t.slice(1))s=this.toCanvasVector(i),e.lineTo(s.x,s.y);e.strokeStyle=i,e.stroke()}drawPoint(t,i=10,e=null){const s=this.context,r=this.toCanvasVector(t);s.beginPath(),s.arc(r.x,r.y,i*this.pixelRatio,0,7,!1),s.fillStyle="#fff",s.fill(),s.strokeStyle=e,s.lineWidth=i/2.5*this.pixelRatio,s.stroke()}drawText(t,i,e){const s=this.context,r=5*this.pixelRatio,a=20*this.pixelRatio;s.font=`${a}px "Segoe UI"`;const n=this.toCanvasVector(i),o=s.measureText(t).width;switch(e){case"NE":s.fillText(t,n.x+r,n.y-r);break;case"NW":s.fillText(t,n.x-o-r,n.y-r);break;case"SE":s.fillText(t,n.x+r,n.y+a+r);break;case"SW":s.fillText(t,n.x-o-r,n.y+a+r);break;default:throw new Error("Invalid argument for type Direction")}}toCanvasVector(t){return new i((t.x-this.fromX)/(this.toX-this.fromX)*this.width*this.pixelRatio,(-t.y-this.fromY)/(this.toY-this.fromY)*this.height*this.pixelRatio)}fromCanvasPoint(t){return new i(t.x/this.width*(this.toX-this.fromX)+this.fromX,(1-t.y/this.height)*(this.toY-this.fromY)+this.fromY)}}const s=async(t,i)=>new Promise((e=>{t.addEventListener(i,(t=>{e(t)}),{once:!0})})),r=t=>t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");var a;a=JSON.parse('[{"x":-0.6,"y":-0.55,"youtubeId":"RbDsOdxZZ94","title":"My Way","artist":"Tom Walker","duration":237},{"x":-0.5,"y":-0.5,"youtubeId":"cO3UI8T4O5M","title":"Drugs","artist":"EDEN","duration":339},{"x":-0.2,"y":-0.3,"youtubeId":"hiOkMt7iJ7g","title":"Enough","artist":"The Tech Thieves","duration":202},{"x":0.1,"y":0.05,"youtubeId":"Fxnl4L8vfKA","title":"Kings & Queens","artist":"Mat Kearney","duration":190},{"x":0.2,"y":0.2,"youtubeId":"Z47pGUpMy-E","title":"Wake Up","artist":"EDEN","duration":280},{"x":0.5,"y":0.3,"youtubeId":"FVFf1-oBl8c","title":"Play Me Like A Violin","artist":"Stephen","duration":233},{"x":0.6,"y":0.5,"youtubeId":"mZE6giedL3Q","title":"Reason","artist":"Matthew Chaim","duration":201}]');new class extends class{constructor(t){this.board=t,this.marker=new e(t,{x:[-1,1],y:[-1,1],width:400,height:400,pixelRatio:window.devicePixelRatio}),this.init()}init(){this.marker.clear(),this.marker.drawArrow({x:-.98,y:0},{x:.98,y:0}),this.marker.drawArrow({x:0,y:-.98},{x:0,y:.98}),this.marker.drawText("Sad",{x:-.03,y:-1},"NW"),this.marker.drawText("Happy",{x:-.08,y:1},"SW"),this.marker.drawText("Calm",{x:-1,y:0},"SE"),this.marker.drawText("Energetic",{x:.9,y:0},"SW")}run(){throw new Error("Unimplemented exception")}}{async run(){this.setupSlider();let t=this.initialState();for(;;){t=(await t)()}}setupSlider(){this.$duration=document.querySelector("#duration");const t=document.querySelector("#duration-tooltip");this.$duration.addEventListener("input",(()=>{t.innerHTML=`${this.$duration.value} min`}))}async initialState(){const t=await s(this.board,"click"),i=this.marker.fromCanvasPoint({x:t.offsetX,y:t.offsetY});return async()=>this.state2(i)}async state2(t){const i=i=>{const e=this.marker.fromCanvasPoint({x:i.offsetX,y:i.offsetY});this.init(),this.marker.drawArrow(t,e)};this.board.addEventListener("mousemove",i);const e=await s(this.board,"click"),r=this.marker.fromCanvasPoint({x:e.offsetX,y:e.offsetY});return this.board.removeEventListener("mousemove",i),async()=>this.fetchPlaylist(t,r)}async fetchPlaylist(i,e){return this.init(),this.marker.drawArrow(i,e),async()=>this.displayPlaylist(i,e,t(a))}async displayPlaylist(t,i,e){const s=document.querySelector("#playlist");if(0===e.length)return s.innerHTML='<p class="user-instruction"><strong>Error:</strong> the server created an empty playlist. Please retry later.</p>',async()=>this.initialState();let a='<div class="wrapper"><ul class="music-list">';for(const t of e)a+=`<li class="item playlist-entry">\n          <img class="cover" src="https://i.ytimg.com/vi/${r(t.youtubeId)}/mqdefault.jpg" alt="Thumbnail" width="85.33" height="48">\n          <span class="title">${r(t.title)}</span>\n          <span class="artist">${r(t.artist)}</span>\n        </li>`;return a+="</ul></div>",a+=`<p class="youtube-link"><a href="http://www.youtube.com/watch_videos?video_ids=${encodeURI(e.map((t=>t.youtubeId)).join(","))}" target="_blank" rel="noopener">Listen on YouTube</a></p>`,s.innerHTML=a,async()=>this.drawPlaylist(t,i,e)}async drawPlaylist(t,e,s){return new Promise((r=>{const a=s.map((t=>new i(t))),n=i=>{const s=[];let r=0,n=a[0];const o=[n];s.push(n);for(const t of a.slice(1)){const e=t.sub(n),a=e.len();if(r+=a,i<r){s.push(n.add(e.scale((i+a-r)/a)));break}o.push(t),s.push(t),n=t}this.init(),this.marker.drawArrow(t,e),this.marker.drawPolyLine(s,"#F00");for(const t of o)this.marker.drawPoint(t,4);return i<r};let o=null;const h=t=>{null===o&&(o=t),n(.001*(t-o))?requestAnimationFrame(h):r((async()=>this.initialState()))};requestAnimationFrame(h)}))}}(document.querySelector("#board")).run()}();
//# sourceMappingURL=index.fd4a7f1e.js.map
