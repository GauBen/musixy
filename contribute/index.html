<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>musixy</title><link rel="stylesheet" href="/musixy/index.f971f4d9.css"></head><body> <h1 class="page-title">musixy</h1> <div class="contribute-form"> <form action="" class="wrapper"> <p class="long-input"> <label for="youtubeLink">Youtube link:</label> <input type="text" name="youtubeLink" id="youtubeLink" required></p> <p> <canvas id="board" class="canvas"></canvas> <input type="hidden" name="x"> <input type="hidden" name="y"> </p> <p class="_center"> <button type="submit" disabled>Add song</button> <strong id="tip">Click on the board to place the song</strong> </p> <p class="_center"> <strong id="number">0</strong> songs in the database </p> </form> </div> <p class="_center"> <a href="/musixy/">Back to homepage</a> </p> <script>!function(){function t(t){return t&&t.__esModule?t.default:t}class e{constructor(t,i){if(t instanceof e||t instanceof Object&&"x"in t&&"y"in t)return this.x=t.x,void(this.y=t.y);this.x=t,this.y=i}static orthographicProjection(t,i,s){const r=new e(i).sub(t).normalize();return new e(r.scale(new e(s).sub(t).dot(r))).add(t)}add(t){return new e(this.x+t.x,this.y+t.y)}sub(t){return new e(this.x-t.x,this.y-t.y)}scale(t){return new e(this.x*t,this.y*t)}rotate(t){return new e(this.x*Math.cos(t)-this.y*Math.sin(t),this.x*Math.sin(t)+this.y*Math.cos(t))}len2(){return this.x*this.x+this.y*this.y}len(){return Math.sqrt(this.len2())}dot(t){return t.x*this.x+t.y*this.y}normalize(){const t=this.len();if(t<Number.EPSILON||!t)throw new Error("Division by zero");return new e(this.x/t,this.y/t)}}class i{constructor(t,{x:[e,i],y:[s,r],pixelsPerUnit:n,pixelRatio:o}){this.canvas=t,this.context=t.getContext("2d"),this.fromX=e,this.fromY=s,this.toX=i,this.toY=r,this.resize(n,o),this.clear()}resize(t,e){this.pixelsPerUnit=t,this.pixelRatio=e,this.canvas.width=(this.toX-this.fromX)*t*e,this.canvas.height=(this.toY-this.fromY)*t*e,this.canvas.style.width=(this.toX-this.fromX)*t+"px",this.canvas.style.height=(this.toY-this.fromY)*t+"px",this.context.lineWidth=3*e}clear(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.lineJoin="round",this.context.lineCap="round",this.context.lineWidth=2*this.pixelRatio,this.context.fillStyle="#000",this.context.strokeStyle="#000"}drawArrow(t,e){const i=this.toCanvasVector(t),s=this.toCanvasVector(e),r=this.context,n=s.sub(i).normalize();r.beginPath(),r.moveTo(i.x,i.y),r.lineTo(s.x-10*n.x,s.y-10*n.y),r.stroke(),r.beginPath(),r.moveTo(s.x,s.y);const o=s.add(n.scale(20*this.pixelRatio).rotate(3*Math.PI/4)),a=s.add(n.scale(20*this.pixelRatio).rotate(5*Math.PI/4));r.lineTo(o.x,o.y),r.lineTo(a.x,a.y),r.closePath(),r.fillStyle="#000",r.fill()}drawPolyLine(t,e=null){const i=this.context;let s=this.toCanvasVector(t[0]);i.beginPath(),i.moveTo(s.x,s.y);for(const e of t.slice(1))s=this.toCanvasVector(e),i.lineTo(s.x,s.y);i.strokeStyle=e,i.stroke()}drawPoint(t,e=10,i=null){const s=this.context,r=this.toCanvasVector(t);s.beginPath(),s.arc(r.x,r.y,e*this.pixelRatio,0,7,!1),s.fillStyle="#fff",s.fill(),s.strokeStyle=i,s.lineWidth=e/2.5*this.pixelRatio,s.stroke()}drawCircle(t,e,i=null){const s=this.context,r=e*this.pixelsPerUnit*this.pixelRatio,n=this.toCanvasVector(t);s.beginPath(),s.arc(n.x,n.y,r,0,7,!1),s.fillStyle="#fff",s.fill(),s.strokeStyle=i,s.lineWidth=2,s.stroke()}drawText(t,e,i){const s=this.context,r=5*this.pixelRatio,n=20*this.pixelRatio;s.font=`${n}px "Segoe UI"`;const o=this.toCanvasVector(e),a=s.measureText(t).width;switch(i){case"NE":s.fillText(t,o.x+r,o.y-r);break;case"NW":s.fillText(t,o.x-a-r,o.y-r);break;case"SE":s.fillText(t,o.x+r,o.y+n+r);break;case"SW":s.fillText(t,o.x-a-r,o.y+n+r);break;default:throw new Error("Invalid argument for type Direction")}}toCanvasVector(t){return new e((t.x-this.fromX)*this.pixelsPerUnit*this.pixelRatio,(-t.y-this.fromY)*this.pixelsPerUnit*this.pixelRatio)}fromCanvasPoint(t){return new e(t.x/this.pixelsPerUnit+this.fromX,(this.canvas.height-t.y)/this.pixelsPerUnit+this.fromY)}}var s,r,n={};s=n,r=function(t){return function(t,e){if(null==e&&(e={fuzzy:!0}),/youtu\.?be/.test(t)){var i,s=[/youtu\.be\/([^#\&\?]{11})/,/\?v=([^#\&\?]{11})/,/\&v=([^#\&\?]{11})/,/embed\/([^#\&\?]{11})/,/\/v\/([^#\&\?]{11})/];for(i=0;i<s.length;++i)if(s[i].test(t))return s[i].exec(t)[1];if(e.fuzzy){var r=t.split(/[\/\&\?=#\.\s]/g);for(i=0;i<r.length;++i)if(/^[^#\&\?]{11}$/.test(r[i]))return r[i]}}return null}},"object"==typeof n?n=function(t,e){if(null==e&&(e={fuzzy:!0}),/youtu\.?be/.test(t)){var i,s=[/youtu\.be\/([^#\&\?]{11})/,/\?v=([^#\&\?]{11})/,/\&v=([^#\&\?]{11})/,/embed\/([^#\&\?]{11})/,/\/v\/([^#\&\?]{11})/];for(i=0;i<s.length;++i)if(s[i].test(t))return s[i].exec(t)[1];if(e.fuzzy){var r=t.split(/[\/\&\?=#\.\s]/g);for(i=0;i<r.length;++i)if(/^[^#\&\?]{11}$/.test(r[i]))return r[i]}}return null}:"function"==typeof define&&define.amd?define(r):s.getYouTubeID=function(t,e){if(null==e&&(e={fuzzy:!0}),/youtu\.?be/.test(t)){var i,s=[/youtu\.be\/([^#\&\?]{11})/,/\?v=([^#\&\?]{11})/,/\&v=([^#\&\?]{11})/,/embed\/([^#\&\?]{11})/,/\/v\/([^#\&\?]{11})/];for(i=0;i<s.length;++i)if(s[i].test(t))return s[i].exec(t)[1];if(e.fuzzy){var r=t.split(/[\/\&\?=#\.\s]/g);for(i=0;i<r.length;++i)if(/^[^#\&\?]{11}$/.test(r[i]))return r[i]}}return null};const o=async(t,e)=>new Promise((i=>{t.addEventListener(e,(t=>{i(t)}),{once:!0})}));new class{constructor(){this.axes=["N","W","S","E"],this.musics=[],this.board=document.querySelector("#board"),this.marker=new i(this.board,{x:[-1,1],y:[-1,1],pixelsPerUnit:200,pixelRatio:window.devicePixelRatio})}async run(){let t=this.initialState();for(;;){t=(await t)()}}async initialState(){const t=document.querySelector("[type=submit]"),e=document.querySelector("#tip"),i=document.querySelector("[name=youtubeLink]");t.disabled=!0,e.hidden=!1,i.value="",this.drawAxes();const s=await o(this.board,"click"),r=this.marker.fromCanvasPoint({x:s.offsetX,y:s.offsetY});return async()=>this.readyToSendState(r)}async readyToSendState(e){const i=document.querySelector("[name=x]"),s=document.querySelector("[name=y]"),r=document.querySelector("[type=submit]"),a=document.querySelector("#tip"),h=document.querySelector("form");this.drawAxes(),this.marker.drawPoint(e,10,"#f00"),a.hidden=!0,r.disabled=!1,i.value=e.x.toFixed(3),s.value=e.y.toFixed(3);return Promise.race([(async()=>{const t=await o(this.board,"click"),e=this.marker.fromCanvasPoint({x:t.offsetX,y:t.offsetY});return async()=>this.readyToSendState(e)})(),(async()=>{(await o(h,"submit")).preventDefault();const i=h.elements,s=t(n)(i.youtubeLink.value);if(null===s)return async()=>this.readyToSendState(e);const r={x:Number(i.x.value),y:Number(i.y.value),youtubeId:s};return async()=>this.addMusic(r)})()])}async addMusic(t){return console.log(t),async()=>this.initialState()}drawAxes(){this.marker.clear(),this.marker.drawArrow({x:-.98,y:0},{x:.98,y:0}),this.marker.drawArrow({x:0,y:-.98},{x:0,y:.98}),this.marker.drawText(this.axes[0],{x:-.03,y:-1},"NW"),this.marker.drawText(this.axes[1],{x:-.08,y:1},"SW"),this.marker.drawText(this.axes[2],{x:-1,y:0},"SE"),this.marker.drawText(this.axes[3],{x:.9,y:0},"SW")}}(document.querySelector("#board")).run()}();</script> </body></html>